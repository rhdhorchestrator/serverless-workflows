# Logging Configuration
quarkus.log.category."org.apache.http".level=INFO
quarkus.log.level=INFO

# ========================================
# Keycloak OIDC Configuration
# ========================================
auth-server-url=${KEYCLOAK_AUTH_SERVER_URL:https://keycloak-rhsso-operator.apps.ocp-test.qe.lab.redhat.com/auth/realms/basic}
client-id=${KEYCLOAK_CLIENT_ID:rhdh}
client-secret=${KEYCLOAK_CLIENT_SECRET}

# OIDC Configuration - Validates incoming tokens from Backstage
quarkus.oidc.auth-server-url=${auth-server-url}
quarkus.oidc.client-id=${client-id}
quarkus.oidc.credentials.secret=${client-secret}
quarkus.oidc.token.header=X-Authorization-Oidc
quarkus.oidc.token.issuer=any
quarkus.oidc.tls.verification=none

# ========================================
# PostgreSQL Database Configuration
# ========================================
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=jdbc:postgresql://backstage-psql-backstage.rhdh-operator.svc.cluster.local:5432/backstage_plugin_orchestrator?currentSchema=greeting-auth
quarkus.datasource.username=${POSTGRES_USER}
quarkus.datasource.password=${POSTGRES_PASSWORD}

# Kogito Persistence Configuration
kogito.persistence.type=jdbc
kogito.persistence.proto.marshaller=false
kogito.persistence.query.timeout.millis=10000

# ========================================
# Token Propagation Configuration
# ========================================
# REST Client URL for httpbin
quarkus.rest-client.httpbin_yaml.url=http://httpbin.rhdh-operator.svc.cluster.local

# Token Propagation Settings - RE-ENABLED
quarkus.openapi-generator.httpbin_yaml.auth.BearerToken.token-propagation=true
quarkus.openapi-generator.httpbin_yaml.auth.BearerToken.header-name=X-Authorization-Oidc

# ========================================
# Data Index Service Event Configuration
# ========================================
# Send workflow events to Data Index Service (NOT localhost!)
mp.messaging.outgoing.kogito-processinstances-events.connector=quarkus-http
mp.messaging.outgoing.kogito-processinstances-events.url=${K_SINK:http://sonataflow-platform-data-index-service.rhdh-operator.svc.cluster.local}
mp.messaging.outgoing.kogito-processdefinitions-events.connector=quarkus-http
mp.messaging.outgoing.kogito-processdefinitions-events.url=${K_SINK:http://sonataflow-platform-data-index-service.rhdh-operator.svc.cluster.local}
mp.messaging.outgoing.kogito-usertasks-events.connector=quarkus-http
mp.messaging.outgoing.kogito-usertasks-events.url=${K_SINK:http://sonataflow-platform-data-index-service.rhdh-operator.svc.cluster.local}
mp.messaging.outgoing.kogito-variables-events.connector=quarkus-http
mp.messaging.outgoing.kogito-variables-events.url=${K_SINK:http://sonataflow-platform-data-index-service.rhdh-operator.svc.cluster.local}

# ========================================
# Development Settings (Remove for Production)
# ========================================
# Disable TLS verification for self-signed certs (DEV ONLY)
quarkus.tls.trust-all=true

# Enable Swagger UI for testing
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/swagger-ui
